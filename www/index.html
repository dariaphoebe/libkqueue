<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="en-us" />

    <title>libkqueue</title>
    <style type="text/css">
    .blockquote { margin-right: 2em }
    </style>
</head>

<body>

<h1>libkqueue</h1>

libkqueue is a portable userspace implementation of the <a href="http://www.freebsd.org/cgi/man.cgi?query=kqueue&sektion=2">kqueue(2)</a> kernel event notification mechanism. Initial efforts are focused on porting the kqueue API to the Linux 2.6 kernel.

<h2>Download</h2>

To checkout the SVN repository, run the following command:
<p>
<code>svn checkout svn://mark.heily.com/libkqueue</code>

<h2>Status</h2>
The current implementation status is <a href="status.html">here</a>.
<p>
There are several compatibility issues to be aware of when using this library under Linux:<p>
<ol>

<li>The NOTE_LOWAT flag is not supported. According to <i>socket(7)</i>,<p>
<pre style="blockquote">
"The select(2) and poll(2) system  calls  currently  do not respect the 
SO_RCVLOWAT setting on Linux, and mark a socket readable when even  a  
single  byte  of data is available.  A subsequent read from the socket 
will block until SO_RCVLOWAT bytes are available."</pre>
</li>

<li>The NOTE_DELETE flag is supported; however, the event will not be triggered if the program holds an open file descriptor to the file being monitored. This behavior isn't documented in any manpage; see <a href="http://lists.schmorp.de/pipermail/libev/2008q4/000443.html">here</a> for discussion.
</li>

</ol>

<h2>Requirements</h2>

libkqueue currently requires the following:

<ul>
<li>GCC
<li>Linux 2.6.22 or higher
<li>glibc 2.8 or higher
</ul>

<h2>Usage</h2>

Assuming that libkqueue is installed under /usr/include:

<ol>
<li>Add <code>-I/usr/lib/kqueue</code> to the CFLAGS variable.
<li>Add <code>#include &lt;sys/event.h&gt;</code> to the source code.
<li>Link against the libkqueue library by appending <code>-lkqueue</code> for single-threaded programs, or <code>-lkqueue_r</code> for multi-threaded programs.
</ol>

One major difference between libkqueue and the real kqueue is that 
closing the kqueue descriptor will not free any of the resources
associated with the descriptor. The following example shows how to
close the descriptor and free the resources:
<p>
<pre>
    int kqfd;

    kqfd = kqueue();

    /* ... */

    close(kqfd);
    #if LIBKQUEUE
    kqueue_free(kqfd);
    #endif
</pre>

If your program accesses an event queue from multiple threads,
you should link against the threadsafe version of the library (libkqueue_r).
This will provide reentrant versions of <code>kqueue()</code> and <code>kevent()</code>.

<h2>Links</h2>

<ul>

<li>
 <a href="http://people.freebsd.org/~jlemon/papers/kqueue.pdf">Kqueue: A generic and scalable event notification facility</a> [Lemon][PDF]
</li>

<li><a href="http://doc.geoffgarside.co.uk/kqueue/">Kqueues for Fun and Profit</a> [Werner]</li>
</ul>

<h2>Contact</h2>
For more information, contact <a href="mailto:devel@heily.com">Mark Heily</a>.

</body>
</html>
