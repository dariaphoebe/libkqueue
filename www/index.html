<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="en-us" />

    <title>libkqueue</title>
    <style type="text/css">
    .blockquote { margin-right: 2em }
    </style>
</head>

<body>

<h1>libkqueue</h1>

libkqueue is a portable userspace implementation of the <a href="http://www.freebsd.org/cgi/man.cgi?query=kqueue&sektion=2">kqueue(2)</a> kernel event notification mechanism. Initial efforts are focused on porting the kqueue API to the Linux 2.6 kernel.

<h2>Download</h2>

Source code releases can be found <a href="dist">here</a>.
<p>
To checkout the SVN repository, run the following command:
<p>
<code>svn checkout svn://mark.heily.com/libkqueue</code>

<h2>Mailing Lists</h2>

There are two mailing lists: one for 
<a href="http://groups.google.com/group/libkqueue">general discussion</a>, and one for 
<a href="http://groups.google.com/group/libkqueue-announce">announcements only</a>.

<h2>Status</h2>

The kqueue and kevent functions are implemented, and most of the filters are working. The following filters are not yet implemented:<p>

<ul>
 <li><code>EVFILT_PROC</code>
 <li><code>EVFILT_AIO</code>
 <li><code>EVFILT_NETDEV</code>
</ul>

More details about the current implementation status can be found <a href="status.html">here</a>.
<p>
There are several compatibility issues to be aware of when using this library under Linux:<p>
<ol>

<li>The NOTE_LOWAT flag is not supported. According to <i>socket(7)</i>,<p>
<pre style="blockquote">
"The select(2) and poll(2) system  calls  currently  do not respect the 
SO_RCVLOWAT setting on Linux, and mark a socket readable when even  a  
single  byte  of data is available.  A subsequent read from the socket 
will block until SO_RCVLOWAT bytes are available."</pre>
</li>

<li>
The NOTE_REVOKE flag is not supported because Linux does not have
a <code>revoke(2)</code> system call.
</li>

<li>
When an EVFILT_SIGNAL event is generated, the <code>data</code> field 
is set to 1 regardless of how many times the signal was received by the process. 
</li>

</ol>

<h2>Requirements</h2>

libkqueue currently requires the following:

<ul>
<li>GCC
<li>Linux 2.6.22 or higher
<li>glibc 2.8 or higher
</ul>

<h2>Usage</h2>

Here are the steps to use libkqueue in your program:
<ol>
<li>Add <code>`pkg-config libkqueue --cflags`</code> to the CFLAGS variable.
<li>Add <code>`pkg-config libkqueue --libs`</code> to the LDADD variable.
<li>Add <code>#include &lt;sys/event.h&gt;</code> to the source code.
</ol>

One major difference between libkqueue and the real kqueue is that 
closing the kqueue descriptor will not free any of the resources
associated with the descriptor. The following example shows how to
close the descriptor and free the resources:
<p>
<pre>
    int kqfd;

    kqfd = kqueue();

    /* ... */

    close(kqfd);
    #if LIBKQUEUE
    kqueue_free(kqfd);
    #endif
</pre>

<h3>Threads</h3>

libkqueue is a threadsafe library, and <code>kqueue()</code> and <code>kevent()</code> are safe to be used from multiple threads.  libkqueue requires that the POSIX threads headers (<code>pthread.h</code>) be available, but does not require you to link against <code>libpthread.so</code>. This allows it to be used in both non-threaded and multi-threaded programs. 

<h2>Links</h2>

<ul>

<li>
 <a href="http://people.freebsd.org/~jlemon/papers/kqueue.pdf">Kqueue: A generic and scalable event notification facility</a> [Lemon][PDF]
</li>

<li><a href="http://doc.geoffgarside.co.uk/kqueue/">Kqueues for Fun and Profit</a> [Werner]</li>
</ul>

<h2>Contact</h2>
For more information, contact <a href="mailto:devel@heily.com">Mark Heily</a>.

</body>
</html>
